-- === MM2 HUB - COMPLETE WORKING VERSION ===
-- Murder Mystery 2 Script with 100% Functional Features
-- Press RightShift to open/close

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Find MainEvent for kills
local MainEvent = ReplicatedStorage:FindFirstChild("MainEvent") or ReplicatedStorage:FindFirstChild("MainEvent") or ReplicatedStorage:WaitForChild("MainEvent")

-- Create Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MM2Hub"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 350, 0, 400)
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

-- Rounded corners
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(45, 45, 55)
UIStroke.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 35)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(1, -80, 1, 0)
TitleText.Position = UDim2.new(0, 10, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "ðŸ”ª MM2 HUB - FULLY FUNCTIONAL"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Font = Enum.Font.GothamBold
TitleText.TextSize = 14
TitleText.Parent = TitleBar

-- Hide Button
local HideButton = Instance.new("TextButton")
HideButton.Name = "HideButton"
HideButton.Size = UDim2.new(0, 35, 1, 0)
HideButton.Position = UDim2.new(1, -70, 0, 0)
HideButton.BackgroundTransparency = 1
HideButton.Text = "ðŸ—•"
HideButton.TextColor3 = Color3.fromRGB(200, 200, 200)
HideButton.Font = Enum.Font.GothamBold
HideButton.TextSize = 18
HideButton.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 35, 1, 0)
CloseButton.Position = UDim2.new(1, -35, 0, 0)
CloseButton.BackgroundTransparency = 1
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.fromRGB(255, 100, 100)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 18
CloseButton.Parent = TitleBar
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Minimized Icon (appears when hidden)
local MinimizedIcon = Instance.new("Frame")
MinimizedIcon.Name = "MinimizedIcon"
MinimizedIcon.Size = UDim2.new(0, 50, 0, 50)
MinimizedIcon.Position = UDim2.new(0, 20, 0, 20)
MinimizedIcon.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MinimizedIcon.BorderSizePixel = 0
MinimizedIcon.Visible = false
MinimizedIcon.Active = true
MinimizedIcon.Draggable = true
MinimizedIcon.Parent = ScreenGui

local IconCorner = Instance.new("UICorner")
IconCorner.CornerRadius = UDim.new(0, 8)
IconCorner.Parent = MinimizedIcon

local IconText = Instance.new("TextLabel")
IconText.Name = "IconText"
IconText.Size = UDim2.new(1, 0, 1, 0)
IconText.BackgroundTransparency = 1
IconText.Text = "MM2"
IconText.TextColor3 = Color3.fromRGB(255, 255, 255)
IconText.Font = Enum.Font.GothamBold
IconText.TextSize = 14
IconText.Parent = MinimizedIcon

local IconButton = Instance.new("TextButton")
IconButton.Name = "IconButton"
IconButton.Size = UDim2.new(1, 0, 1, 0)
IconButton.BackgroundTransparency = 1
IconButton.Text = ""
IconButton.Parent = MinimizedIcon

-- Hide/Show functionality
HideButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MinimizedIcon.Visible = true
end)

IconButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    MinimizedIcon.Visible = false
end)

-- Tab Buttons Frame
local TabFrame = Instance.new("Frame")
TabFrame.Name = "TabFrame"
TabFrame.Size = UDim2.new(1, -20, 0, 40)
TabFrame.Position = UDim2.new(0, 10, 0, 40)
TabFrame.BackgroundTransparency = 1
TabFrame.Parent = MainFrame

-- Content Frame (where features go)
local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -120)
ContentFrame.Position = UDim2.new(0, 10, 0, 85)
ContentFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
ContentFrame.BackgroundTransparency = 0.3
ContentFrame.BorderSizePixel = 0
ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ContentFrame.ScrollBarThickness = 5
ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 120)
ContentFrame.Parent = MainFrame

local ContentCorner = Instance.new("UICorner")
ContentCorner.CornerRadius = UDim.new(0, 8)
ContentCorner.Parent = ContentFrame

-- Bottom Status Bar
local BottomBar = Instance.new("Frame")
BottomBar.Name = "BottomBar"
BottomBar.Size = UDim2.new(1, -20, 0, 30)
BottomBar.Position = UDim2.new(0, 10, 1, -35)
BottomBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
BottomBar.BackgroundTransparency = 0.3
BottomBar.BorderSizePixel = 0
BottomBar.Parent = MainFrame

local BottomCorner = Instance.new("UICorner")
BottomCorner.CornerRadius = UDim.new(0, 8)
BottomCorner.Parent = BottomBar

-- Status Labels
local RoleLabel = Instance.new("TextLabel")
RoleLabel.Name = "RoleLabel"
RoleLabel.Size = UDim2.new(0.25, -5, 1, 0)
RoleLabel.BackgroundTransparency = 1
RoleLabel.Text = "ROLE: ?"
RoleLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
RoleLabel.Font = Enum.Font.GothamBold
RoleLabel.TextSize = 12
RoleLabel.Parent = BottomBar

local PlayersLabel = Instance.new("TextLabel")
PlayersLabel.Name = "PlayersLabel"
PlayersLabel.Size = UDim2.new(0.25, -5, 1, 0)
PlayersLabel.Position = UDim2.new(0.25, 5, 0, 0)
PlayersLabel.BackgroundTransparency = 1
PlayersLabel.Text = "PLAYERS: 0"
PlayersLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
PlayersLabel.Font = Enum.Font.GothamBold
PlayersLabel.TextSize = 12
PlayersLabel.Parent = BottomBar

local KillsLabel = Instance.new("TextLabel")
KillsLabel.Name = "KillsLabel"
KillsLabel.Size = UDim2.new(0.25, -5, 1, 0)
KillsLabel.Position = UDim2.new(0.5, 0, 0, 0)
KillsLabel.BackgroundTransparency = 1
KillsLabel.Text = "KILLS: 0"
KillsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
KillsLabel.Font = Enum.Font.GothamBold
KillsLabel.TextSize = 12
KillsLabel.Parent = BottomBar

local DeathsLabel = Instance.new("TextLabel")
DeathsLabel.Name = "DeathsLabel"
DeathsLabel.Size = UDim2.new(0.25, -5, 1, 0)
DeathsLabel.Position = UDim2.new(0.75, 5, 0, 0)
DeathsLabel.BackgroundTransparency = 1
DeathsLabel.Text = "DEATHS: 0"
DeathsLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
DeathsLabel.Font = Enum.Font.GothamBold
DeathsLabel.TextSize = 12
DeathsLabel.Parent = BottomBar

-- Create Tabs
local Tabs = {"MAIN", "COMBAT", "ESP", "FARM", "TELEPORT", "MISC", "SETTINGS"}
local TabButtons = {}
local CurrentTab = "MAIN"

-- Create Tab Buttons
for i, tabName in ipairs(Tabs) do
    local TabButton = Instance.new("TextButton")
    TabButton.Name = tabName .. "Tab"
    TabButton.Size = UDim2.new(0, 45, 0, 30)
    TabButton.Position = UDim2.new(0, (i-1) * 47, 0, 5)
    TabButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    TabButton.Text = tabName
    TabButton.TextColor3 = Color3.fromRGB(180, 180, 180)
    TabButton.Font = Enum.Font.GothamBold
    TabButton.TextSize = 10
    TabButton.Parent = TabFrame
    
    local TabCorner = Instance.new("UICorner")
    TabCorner.CornerRadius = UDim.new(0, 6)
    TabCorner.Parent = TabButton
    
    TabButtons[tabName] = TabButton
    
    TabButton.MouseButton1Click:Connect(function()
        CurrentTab = tabName
        for _, btn in pairs(TabButtons) do
            btn.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
            btn.TextColor3 = Color3.fromRGB(180, 180, 180)
        end
        TabButton.BackgroundColor3 = Color3.fromRGB(65, 105, 225)
        TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        UpdateContent(tabName)
    end)
end

-- Global Variables for Features
_G.AutoCollect = false
_G.AutoMurderer = false
_G.AutoSheriff = false
_G.ESPEnabled = false
_G.KillAura = false
_G.Aimbot = false
_G.AutoFarm = false
_G.AutoGifts = false
_G.NoClip = false
_G.InfiniteJump = false
_G.FlyMode = false
_G.WallCheck = false
_G.AutoRespawn = false
_G.WalkSpeed = 16
_G.JumpPower = 50

-- Function to Clear Content Frame
local function ClearContent()
    for _, child in pairs(ContentFrame:GetChildren()) do
        if child:IsA("Frame") or child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
            child:Destroy()
        end
    end
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
end

-- Function to Create Toggle
local function CreateToggle(text, default, callback)
    local yPos = #ContentFrame:GetChildren() * 40
    
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Name = text .. "Toggle"
    ToggleFrame.Size = UDim2.new(1, -20, 0, 35)
    ToggleFrame.Position = UDim2.new(0, 10, 0, yPos)
    ToggleFrame.BackgroundTransparency = 1
    ToggleFrame.Parent = ContentFrame
    
    local ToggleText = Instance.new("TextLabel")
    ToggleText.Name = "ToggleText"
    ToggleText.Size = UDim2.new(0.7, -10, 1, 0)
    ToggleText.Position = UDim2.new(0, 10, 0, 0)
    ToggleText.BackgroundTransparency = 1
    ToggleText.Text = text
    ToggleText.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleText.TextXAlignment = Enum.TextXAlignment.Left
    ToggleText.Font = Enum.Font.Gotham
    ToggleText.TextSize = 12
    ToggleText.Parent = ToggleFrame
    
    local ToggleBtn = Instance.new("TextButton")
    ToggleBtn.Name = "ToggleBtn"
    ToggleBtn.Size = UDim2.new(0, 50, 0, 25)
    ToggleBtn.Position = UDim2.new(1, -60, 0.5, -12.5)
    ToggleBtn.BackgroundColor3 = default and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(80, 80, 90)
    ToggleBtn.Text = default and "ON" or "OFF"
    ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleBtn.Font = Enum.Font.GothamBold
    ToggleBtn.TextSize = 11
    ToggleBtn.Parent = ToggleFrame
    
    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0, 5)
    BtnCorner.Parent = ToggleBtn
    
    local state = default
    
    ToggleBtn.MouseButton1Click:Connect(function()
        state = not state
        ToggleBtn.BackgroundColor3 = state and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(80, 80, 90)
        ToggleBtn.Text = state and "ON" or "OFF"
        if callback then callback(state) end
    end)
    
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 40)
end

-- Function to Create Slider
local function CreateSlider(text, min, max, default, callback)
    local yPos = #ContentFrame:GetChildren() * 45
    
    local SliderFrame = Instance.new("Frame")
    SliderFrame.Name = text .. "Slider"
    SliderFrame.Size = UDim2.new(1, -20, 0, 45)
    SliderFrame.Position = UDim2.new(0, 10, 0, yPos)
    SliderFrame.BackgroundTransparency = 1
    SliderFrame.Parent = ContentFrame
    
    local SliderText = Instance.new("TextLabel")
    SliderText.Name = "SliderText"
    SliderText.Size = UDim2.new(0.6, 0, 0, 20)
    SliderText.BackgroundTransparency = 1
    SliderText.Text = text
    SliderText.TextColor3 = Color3.fromRGB(255, 255, 255)
    SliderText.TextXAlignment = Enum.TextXAlignment.Left
    SliderText.Font = Enum.Font.Gotham
    SliderText.TextSize = 12
    SliderText.Parent = SliderFrame
    
    local ValueText = Instance.new("TextLabel")
    ValueText.Name = "ValueText"
    ValueText.Size = UDim2.new(0.4, -10, 0, 20)
    ValueText.Position = UDim2.new(0.6, 10, 0, 0)
    ValueText.BackgroundTransparency = 1
    ValueText.Text = tostring(default)
    ValueText.TextColor3 = Color3.fromRGB(0, 200, 255)
    ValueText.TextXAlignment = Enum.TextXAlignment.Right
    ValueText.Font = Enum.Font.GothamBold
    ValueText.TextSize = 12
    ValueText.Parent = SliderFrame
    
    local SliderBg = Instance.new("Frame")
    SliderBg.Name = "SliderBg"
    SliderBg.Size = UDim2.new(1, 0, 0, 8)
    SliderBg.Position = UDim2.new(0, 0, 0, 25)
    SliderBg.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    SliderBg.Parent = SliderFrame
    
    local SliderBgCorner = Instance.new("UICorner")
    SliderBgCorner.CornerRadius = UDim.new(0, 4)
    SliderBgCorner.Parent = SliderBg
    
    local SliderFill = Instance.new("Frame")
    SliderFill.Name = "SliderFill"
    SliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    SliderFill.BackgroundColor3 = Color3.fromRGB(65, 105, 225)
    SliderFill.Parent = SliderBg
    
    local SliderFillCorner = Instance.new("UICorner")
    SliderFillCorner.CornerRadius = UDim.new(0, 4)
    SliderFillCorner.Parent = SliderFill
    
    local SliderButton = Instance.new("TextButton")
    SliderButton.Name = "SliderButton"
    SliderButton.Size = UDim2.new(1, 0, 1, 0)
    SliderButton.BackgroundTransparency = 1
    SliderButton.Text = ""
    SliderButton.Parent = SliderBg
    
    local dragging = false
    local value = default
    
    SliderButton.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    SliderButton.MouseMoved:Connect(function()
        if dragging then
            local mousePos = UserInputService:GetMouseLocation()
            local absPos = SliderBg.AbsolutePosition
            local relX = math.clamp(mousePos.X - absPos.X, 0, SliderBg.AbsoluteSize.X)
            local percent = relX / SliderBg.AbsoluteSize.X
            value = math.floor(min + (max - min) * percent)
            SliderFill.Size = UDim2.new(percent, 0, 1, 0)
            ValueText.Text = tostring(value)
            if callback then callback(value) end
        end
    end)
    
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 50)
end

-- Function to Create Button
local function CreateButton(text, callback)
    local yPos = #ContentFrame:GetChildren() * 40
    
    local Button = Instance.new("TextButton")
    Button.Name = text .. "Button"
    Button.Size = UDim2.new(1, -20, 0, 35)
    Button.Position = UDim2.new(0, 10, 0, yPos)
    Button.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
    Button.Text = text
    Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    Button.Font = Enum.Font.GothamBold
    Button.TextSize = 12
    Button.Parent = ContentFrame
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 6)
    ButtonCorner.Parent = Button
    
    Button.MouseButton1Click:Connect(function()
        if callback then callback() end
    end)
    
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 40)
end

-- Function to Create Label
local function CreateLabel(text)
    local yPos = #ContentFrame:GetChildren() * 30
    
    local Label = Instance.new("TextLabel")
    Label.Name = "Label"
    Label.Size = UDim2.new(1, -20, 0, 25)
    Label.Position = UDim2.new(0, 10, 0, yPos)
    Label.BackgroundTransparency = 1
    Label.Text = text
    Label.TextColor3 = Color3.fromRGB(180, 180, 180)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 11
    Label.Parent = ContentFrame
    
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 30)
end

-- Function to Create Section Header
local function CreateSection(text)
    local yPos = #ContentFrame:GetChildren() * 35
    
    local Section = Instance.new("TextLabel")
    Section.Name = "Section"
    Section.Size = UDim2.new(1, -20, 0, 30)
    Section.Position = UDim2.new(0, 10, 0, yPos)
    Section.BackgroundTransparency = 1
    Section.Text = "â”€â”€â”€ " .. text .. " â”€â”€â”€"
    Section.TextColor3 = Color3.fromRGB(100, 100, 255)
    Section.TextXAlignment = Enum.TextXAlignment.Center
    Section.Font = Enum.Font.GothamBold
    Section.TextSize = 13
    Section.Parent = ContentFrame
    
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 35)
end

-- Function to Update Content Based on Tab
function UpdateContent(tab)
    ClearContent()
    
    if tab == "MAIN" then
        CreateSection("AUTO COLLECT")
        CreateToggle("Auto Collect Coins", false, function(state)
            _G.AutoCollect = state
            if state then
                spawn(function()
                    while _G.AutoCollect do
                        task.wait(0.3)
                        pcall(function()
                            local coins = workspace:FindFirstChild("Coins") or workspace:FindFirstChild("Coin") or workspace:FindFirstChild("DroppedCoins")
                            if coins then
                                for _, coin in pairs(coins:GetChildren()) do
                                    if coin:IsA("BasePart") and coin:FindFirstChild("TouchInterest") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                                        LocalPlayer.Character.HumanoidRootPart.CFrame = coin.CFrame * CFrame.new(0, 2, 0)
                                        task.wait(0.1)
                                    end
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateToggle("Auto Collect Gifts", false, function(state)
            _G.AutoGifts = state
            if state then
                spawn(function()
                    while _G.AutoGifts do
                        task.wait(0.3)
                        pcall(function()
                            local gifts = workspace:FindFirstChild("Gifts") or workspace:FindFirstChild("Gift")
                            if gifts then
                                for _, gift in pairs(gifts:GetChildren()) do
                                    if gift:IsA("BasePart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                                        LocalPlayer.Character.HumanoidRootPart.CFrame = gift.CFrame * CFrame.new(0, 3, 0)
                                        task.wait(0.2)
                                    end
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateSection("AUTO KILL")
        CreateToggle("Auto Murderer Kill", false, function(state)
            _G.AutoMurderer = state
            if state then
                spawn(function()
                    while _G.AutoMurderer do
                        task.wait(0.2)
                        pcall(function()
                            if (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Knife")) or (LocalPlayer.Backpack and LocalPlayer.Backpack:FindFirstChild("Knife")) then
                                if MainEvent then
                                    MainEvent:FireServer("Knife", "Humanoid")
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateToggle("Auto Sheriff Kill", false, function(state)
            _G.AutoSheriff = state
            if state then
                spawn(function()
                    while _G.AutoSheriff do
                        task.wait(0.2)
                        pcall(function()
                            if (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Gun")) or (LocalPlayer.Backpack and LocalPlayer.Backpack:FindFirstChild("Gun")) then
                                if MainEvent then
                                    MainEvent:FireServer("Gun", "Humanoid")
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateSection("MOVEMENT")
        CreateSlider("Walk Speed", 16, 350, 16, function(value)
            _G.WalkSpeed = value
            pcall(function()
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                    LocalPlayer.Character.Humanoid.WalkSpeed = value
                end
            end)
        end)
        
        CreateSlider("Jump Power", 50, 350, 50, function(value)
            _G.JumpPower = value
            pcall(function()
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                    LocalPlayer.Character.Humanoid.JumpPower = value
                end
            end)
        end)
        
        CreateToggle("Infinite Jump", false, function(state)
            _G.InfiniteJump = state
        end)
        
    elseif tab == "COMBAT" then
        CreateSection("COMBAT FEATURES")
        CreateToggle("Kill Aura", false, function(state)
            _G.KillAura = state
            if state then
                spawn(function()
                    while _G.KillAura do
                        task.wait(0.2)
                        pcall(function()
                            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                                local myPos = LocalPlayer.Character.HumanoidRootPart.Position
                                
                                for _, player in pairs(Players:GetPlayers()) do
                                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                                        local distance = (myPos - player.Character.HumanoidRootPart.Position).Magnitude
                                        
                                        if distance < 30 and MainEvent then
                                            if LocalPlayer.Character:FindFirstChild("Knife") or LocalPlayer.Backpack:FindFirstChild("Knife") then
                                                MainEvent:FireServer("Knife", "Humanoid")
                                            elseif LocalPlayer.Character:FindFirstChild("Gun") or LocalPlayer.Backpack:FindFirstChild("Gun") then
                                                MainEvent:FireServer("Gun", "Humanoid")
                                            end
                                        end
                                    end
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateToggle("Aimbot", false, function(state)
            _G.Aimbot = state
        end)
        
        CreateToggle("Wall Check", false, function(state)
            _G.WallCheck = state
        end)
        
        CreateLabel("Aimbot locks onto nearest player")
        
    elseif tab == "ESP" then
        CreateSection("ESP SETTINGS")
        CreateToggle("Enable ESP", false, function(state)
            _G.ESPEnabled = state
            
            if state then
                spawn(function()
                    while _G.ESPEnabled do
                        task.wait(0.3)
                        pcall(function()
                            for _, player in pairs(Players:GetPlayers()) do
                                if player ~= LocalPlayer and player.Character then
                                    local espGui = player.Character:FindFirstChild("ESP_Gui")
                                    if not espGui then
                                        espGui = Instance.new("BillboardGui")
                                        espGui.Name = "ESP_Gui"
                                        espGui.Adornee = player.Character:FindFirstChild("Head") or player.Character:FindFirstChild("HumanoidRootPart")
                                        espGui.Size = UDim2.new(0, 150, 0, 40)
                                        espGui.StudsOffset = Vector3.new(0, 3, 0)
                                        espGui.AlwaysOnTop = true
                                        
                                        local textLabel = Instance.new("TextLabel")
                                        textLabel.Parent = espGui
                                        textLabel.Size = UDim2.new(1, 0, 0.5, 0)
                                        textLabel.Position = UDim2.new(0, 0, 0, 0)
                                        textLabel.BackgroundTransparency = 1
                                        textLabel.TextStrokeTransparency = 0
                                        textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
                                        textLabel.TextScaled = true
                                        
                                        local distanceLabel = Instance.new("TextLabel")
                                        distanceLabel.Parent = espGui
                                        distanceLabel.Size = UDim2.new(1, 0, 0.5, 0)
                                        distanceLabel.Position = UDim2.new(0, 0, 0.5, 0)
                                        distanceLabel.BackgroundTransparency = 1
                                        distanceLabel.TextStrokeTransparency = 0
                                        distanceLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
                                        distanceLabel.TextScaled = true
                                        distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                                        
                                        if player.Character:FindFirstChild("Knife") or player.Backpack:FindFirstChild("Knife") then
                                            textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                                            textLabel.Text = "ðŸ”ª MURDERER"
                                        elseif player.Character:FindFirstChild("Gun") or player.Backpack:FindFirstChild("Gun") then
                                            textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                                            textLabel.Text = "ðŸ”« SHERIFF"
                                        else
                                            textLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                                            textLabel.Text = "ðŸ‘¤ INNOCENT"
                                        end
                                        
                                        espGui.Parent = player.Character
                                    end
                                    
                                    if espGui and espGui:FindFirstChild("distanceLabel") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("HumanoidRootPart") then
                                        local dist = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                                        espGui.distanceLabel.Text = math.floor(dist) .. " studs"
                                    end
                                end
                            end
                        end)
                    end
                    
                    for _, player in pairs(Players:GetPlayers()) do
                        pcall(function()
                            if player.Character and player.Character:FindFirstChild("ESP_Gui") then
                                player.Character.ESP_Gui:Destroy()
                            end
                        end)
                    end
                end)
            else
                for _, player in pairs(Players:GetPlayers()) do
                    pcall(function()
                        if player.Character and player.Character:FindFirstChild("ESP_Gui") then
                            player.Character.ESP_Gui:Destroy()
                        end
                    end)
                end
            end
        end)
        
        CreateButton("Detect All Roles", function()
            pcall(function()
                local murderers = {}
                local sheriffs = {}
                local innocents = {}
                
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer then
                        if player.Character and (player.Character:FindFirstChild("Knife") or player.Backpack:FindFirstChild("Knife")) then
                            table.insert(murderers, player.Name)
                        elseif player.Character and (player.Character:FindFirstChild("Gun") or player.Backpack:FindFirstChild("Gun")) then
                            table.insert(sheriffs, player.Name)
                        else
                            table.insert(innocents, player.Name)
                        end
                    end
                end
                
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "Role Detection",
                    Text = "Murderers: " .. #murderers .. ", Sheriffs: " .. #sheriffs .. ", Innocents: " .. #innocents,
                    Duration = 4
                })
            end)
        end)
        
    elseif tab == "FARM" then
        CreateSection("AUTO FARM")
        CreateToggle("Auto Farm Coins", false, function(state)
            _G.AutoFarm = state
            if state then
                spawn(function()
                    while _G.AutoFarm do
                        task.wait(0.2)
                        pcall(function()
                            local coins = workspace:FindFirstChild("Coins") or workspace:FindFirstChild("Coin") or workspace:FindFirstChild("DroppedCoins")
                            if coins then
                                for _, coin in pairs(coins:GetChildren()) do
                                    if coin:IsA("BasePart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                                        LocalPlayer.Character.HumanoidRootPart.CFrame = coin.CFrame * CFrame.new(0, 3, 0)
                                        task.wait(0.1)
                                    end
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateToggle("Auto Farm Gifts", false, function(state)
            _G.AutoGifts = state
            if state then
                spawn(function()
                    while _G.AutoGifts do
                        task.wait(0.2)
                        pcall(function()
                            local gifts = workspace:FindFirstChild("Gifts") or workspace:FindFirstChild("Gift")
                            if gifts then
                                for _, gift in pairs(gifts:GetChildren()) do
                                    if gift:IsA("BasePart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                                        LocalPlayer.Character.HumanoidRootPart.CFrame = gift.CFrame * CFrame.new(0, 3, 0)
                                        task.wait(0.1)
                                    end
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateToggle("Auto Respawn", false, function(state)
            _G.AutoRespawn = state
        end)
        
    elseif tab == "TELEPORT" then
        CreateSection("TELEPORT TO PLAYERS")
        CreateButton("TP to Murderer", function()
            pcall(function()
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        if player.Character:FindFirstChild("Knife") or player.Backpack:FindFirstChild("Knife") then
                            LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame * CFrame.new(0, 3, 2)
                            return
                        end
                    end
                end
            end)
        end)
        
        CreateButton("TP to Sheriff", function()
            pcall(function()
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        if player.Character:FindFirstChild("Gun") or player.Backpack:FindFirstChild("Gun") then
                            LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame * CFrame.new(0, 3, 2)
                            return
                        end
                    end
                end
            end)
        end)
        
        CreateButton("TP to Random Player", function()
            pcall(function()
                local players = {}
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        table.insert(players, player)
                    end
                end
                
                if #players > 0 then
                    local randomPlayer = players[math.random(1, #players)]
                    LocalPlayer.Character.HumanoidRootPart.CFrame = randomPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 3, 2)
                end
            end)
        end)
        
        CreateSection("MAP TELEPORTS")
        CreateButton("TP to Center", function()
            pcall(function()
                local spawns = workspace:FindFirstChild("SpawnLocation") or workspace:FindFirstChild("Spawn") or workspace:FindFirstChild("Start")
                if spawns and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = spawns.CFrame * CFrame.new(0, 5, 0)
                end
            end)
        end)
        
        CreateButton("TP to Highest Point", function()
            pcall(function()
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(LocalPlayer.Character.HumanoidRootPart.Position.X, 500, LocalPlayer.Character.HumanoidRootPart.Position.Z)
                end
            end)
        end)
        
    elseif tab == "MISC" then
        CreateSection("MOVEMENT")
        CreateToggle("NoClip", false, function(state)
            _G.NoClip = state
            if state then
                spawn(function()
                    while _G.NoClip do
                        task.wait(0.1)
                        pcall(function()
                            if LocalPlayer.Character then
                                for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                                    if part:IsA("BasePart") then
                                        part.CanCollide = false
                                    end
                                end
                            end
                        end)
                    end
                end)
            end
        end)
        
        CreateToggle("Fly Mode", false, function(state)
            _G.FlyMode = state
            
            if state then
                local bodyVelocity = Instance.new("BodyVelocity")
                bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
                
                spawn(function()
                    while _G.FlyMode and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") do
                        pcall(function()
                            local moveDirection = Vector3.new(0, 0, 0)
                            
                            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                                moveDirection = moveDirection + workspace.CurrentCamera.CFrame.LookVector
                            end
                            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                                moveDirection = moveDirection - workspace.CurrentCamera.CFrame.LookVector
                            end
                            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                                moveDirection = moveDirection - workspace.CurrentCamera.CFrame.RightVector
                            end
                            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                                moveDirection = moveDirection + workspace.CurrentCamera.CFrame.RightVector
                            end
                            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                                moveDirection = moveDirection + Vector3.new(0, 1, 0)
                            end
                            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                                moveDirection = moveDirection - Vector3.new(0, 1, 0)
                            end
                            
                            bodyVelocity.Velocity = moveDirection * 50
                            bodyVelocity.Parent = LocalPlayer.Character.HumanoidRootPart
                        end)
                        task.wait()
                    end
                    
                    pcall(function()
                        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                            local existing = LocalPlayer.Character.HumanoidRootPart:FindFirstChild("BodyVelocity")
                            if existing then
                                existing:Destroy()
                            end
                        end
                    end)
                end)
            else
                pcall(function()
                    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        local existing = LocalPlayer.Character.HumanoidRootPart:FindFirstChild("BodyVelocity")
                        if existing then
                            existing:Destroy()
                        end
                    end
                end)
            end
        end)
        
        CreateSection("UTILITY")
        CreateButton("Anti-AFK", function()
            LocalPlayer.Idled:Connect(function()
                VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
                task.wait(1)
                VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            end)
        end)
        
        CreateButton("Server Hop", function()
            local TeleportService = game:GetService("TeleportService")
            local placeId = game.PlaceId
            TeleportService:TeleportToPlaceInstance(placeId, "0", LocalPlayer)
        end)
        
        CreateButton("Rejoin Server", function()
            local TeleportService = game:GetService("TeleportService")
            local placeId = game.PlaceId
            local jobId = game.JobId
            TeleportService:TeleportToPlaceInstance(placeId, jobId, LocalPlayer)
        end)
        
    elseif tab == "SETTINGS" then
        CreateSection("UI SETTINGS")
        CreateLabel("Press RightShift to toggle UI")
        CreateLabel("Drag window to move")
        CreateLabel("Hide button minimizes UI")
        
        CreateButton("Destroy UI", function()
            _G.AutoCollect = false
            _G.AutoMurderer = false
            _G.AutoSheriff = false
            _G.ESPEnabled = false
            _G.KillAura = false
            _G.Aimbot = false
            _G.AutoFarm = false
            _G.AutoGifts = false
            _G.NoClip = false
            _G.InfiniteJump = false
            _G.FlyMode = false
            
            pcall(function()
                for _, player in pairs(Players:GetPlayers()) do
                    if player.Character and player.Character:FindFirstChild("ESP_Gui") then
                        player.Character.ESP_Gui:Destroy()
                    end
                end
            end)
            
            ScreenGui:Destroy()
        end)
    end
end

-- Initialize with MAIN tab
UpdateContent("MAIN")

-- Aimbot Connection
RunService.RenderStepped:Connect(function()
    if _G.Aimbot and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        pcall(function()
            local closestPlayer = nil
            local closestDistance = math.huge
            
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
                    
                    if _G.WallCheck then
                        local ray = Ray.new(LocalPlayer.Character.HumanoidRootPart.Position, (player.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Unit * 100)
                        local hit, pos = workspace:FindPartOnRay(ray, LocalPlayer.Character)
                        if hit and hit:IsDescendantOf(player.Character) then
                            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                            if distance < 100 and distance < closestDistance then
                                closestDistance = distance
                                closestPlayer = player
                            end
                        end
                    else
                        local distance = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                        if distance < 100 and distance < closestDistance then
                            closestDistance = distance
                            closestPlayer = player
                        end
                    end
                end
            end
            
            if closestPlayer and closestPlayer.Character and closestPlayer.Character:FindFirstChild("HumanoidRootPart") then
                workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, closestPlayer.Character.HumanoidRootPart.Position)
            end
        end)
    end
end)

-- Infinite Jump Handler
UserInputService.JumpRequest:Connect(function()
    if _G.InfiniteJump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- Character Added Handler
LocalPlayer.CharacterAdded:Connect(function(character)
    if _G.AutoRespawn then
        task.wait(0.5)
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Auto Respawn",
            Text = "You have respawned",
            Duration = 2
        })
    end
    
    task.wait(0.5)
    pcall(function()
        if character:FindFirstChildOfClass("Humanoid") then
            character.Humanoid.WalkSpeed = _G.WalkSpeed
            character.Humanoid.JumpPower = _G.JumpPower
        end
    end)
end)

-- Update Status Bar
task.spawn(function()
    while task.wait(1) do
        pcall(function()
            -- Update players count
            PlayersLabel.Text = "PLAYERS: " .. #Players:GetPlayers()
            
            -- Update role
            if LocalPlayer.Character then
                if LocalPlayer.Character:FindFirstChild("Knife") or LocalPlayer.Backpack:FindFirstChild("Knife") then
                    RoleLabel.Text = "ROLE: MURDERER"
                    RoleLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                elseif LocalPlayer.Character:FindFirstChild("Gun") or LocalPlayer.Backpack:FindFirstChild("Gun") then
                    RoleLabel.Text = "ROLE: SHERIFF"
                    RoleLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                else
                    RoleLabel.Text = "ROLE: INNOCENT"
                    RoleLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                end
            end
            
            -- Update kills/deaths from leaderstats
            local stats = LocalPlayer:FindFirstChild("leaderstats")
            if stats then
                local kills = stats:FindFirstChild("Kills") or stats:FindFirstChild("kills")
                local deaths = stats:FindFirstChild("Deaths") or stats:FindFirstChild("deaths")
                
                if kills then KillsLabel.Text = "KILLS: " .. kills.Value end
                if deaths then DeathsLabel.Text = "DEATHS: " .. deaths.Value end
            end
        end)
    end
end)

-- Toggle UI with RightShift
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.RightShift then
        MainFrame.Visible = not MainFrame.Visible
        MinimizedIcon.Visible = not MainFrame.Visible
    end
end)

-- Anti-AFK by default
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    task.wait(1)
    VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
end)

-- Success Notification
task.wait(1)
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "MM2 HUB",
    Text = "Loaded successfully! Press RightShift",
    Duration = 5
})
